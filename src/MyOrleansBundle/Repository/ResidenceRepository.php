<?php

namespace MyOrleansBundle\Repository;

/**
 * ResidenceRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ResidenceRepository extends \Doctrine\ORM\EntityRepository
{
    public function simpleSearch($ville, $type)
    {
        if (!$type) {
            $qb = $this->createQueryBuilder('r')
                ->where('r.ville LIKE :ville')
                ->setParameter('ville', '%'.$ville.'%');
            return $qb->getQuery()->getResult();
        }

        $qb = $this->createQueryBuilder('r')
            ->where('r.ville LIKE :ville')
            ->setParameter('ville', '%'.$ville.'%')
            ->join('r.flats', 'f')
            ->andWhere('f.type = :type')
            ->setParameter('type', $type);
        return $qb->getQuery()->getResult();
    }
}
